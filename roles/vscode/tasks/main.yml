- name: Import platform tasks (Arch Linux)
  ansible.builtin.import_tasks: archlinux.yml
  when: ansible_distribution == 'Archlinux'

- name: Import platform tasks (macOS)
  ansible.builtin.import_tasks: macos.yml
  when: ansible_distribution == 'MacOSX'

- name: Install VS Code extensions from registry
  ansible.builtin.command:
    cmd: 'code --install-extension {{ item.name }}@{{ item.version }}'
    creates: '{{ ansible_env.HOME }}/.vscode/extensions/{{ item.name + "-" + item.version }}'
  loop:
    - { name: 'vscodevim.vim', version: '1.22.2' }

- name: Ensure VSCode config directory exists (Arch Linux)
  ansible.builtin.file:
    path: '{{ ansible_env.HOME }}/.config/Code/User'
    state: directory

- name: Link settings.json into place (Arch Linux)
  ansible.builtin.file:
    src: '{{ role_path }}/files/settings.json'
    dest: '{{ ansible_env.HOME }}/.config/Code/User/settings.json'
    state: link
